# Спецификация фичи: Создание пользователя через API

**Фича-ветка**: `001-create-user`
**Создана**: 2026-02-05
**Статус**: Черновик
**Входные данные**: Описание пользователя: "Создание пользователя через API"

## Уточнения

### Сессия 2026-02-05

- Q: Должен ли username быть уникальным или его не должно быть вообще? → A: Username не должно быть, только email используется для идентификации пользователя
- Q: Должны ли быть дополнительные требования к сложности пароля? → A: Да, требовать минимум 1 заглавную букву, 1 строчную букву и 1 цифру

## Сценарии использования и тестирование *(обязательно)*

### Сценарий пользователя 1 - Успешное создание пользователя (Приоритет: P1)

Как клиент API, я хочу создать нового пользователя через POST-запрос к API endpoint, чтобы добавить сотрудника в систему.

**Почему этот приоритет**: Это базовая функциональность, необходимая для работы системы. Без неё невозможно добавлять пользователей в систему.

**Независимая проверка**: Можно полностью протестировать отправкой POST-запроса с валидными данными и проверкой, что пользователь создан в БД и возвращён корректный ответ.

**Приемочные сценарии**:

1. **Дано** API endpoint для создания пользователей доступен, **Когда** отправляется POST-запрос с валидными данными пользователя (email, first_name, last_name, password), **Тогда** система возвращает статус 201 и объект созданного пользователя с полями id, email, first_name, last_name (без пароля)
2. **Дано** пользователь с таким email уже существует в системе, **Когда** отправляется POST-запрос для создания пользователя с этим email, **Тогда** система возвращает статус 409 и сообщение об ошибке, указывающее что email уже занят
3. **Дано** API endpoint для создания пользователей доступен, **Когда** отправляется POST-запрос с невалидными данными (невалидный email, пустой password), **Тогда** система возвращает статус 422 с детализацией ошибок валидации
4. **Дано** API endpoint для создания пользователей доступен, **Когда** отправляется POST-запрос с валидными данными, **Тогда** пароль пользователя сохраняется в БД в захешированном виде (plain text пароль не хранится)

---

### Сценарий пользователя 2 - Валидация данных пользователя (Приоритет: P2)

Как клиент API, я хочу получать понятные сообщения об ошибках при невалидных данных, чтобы быстро исправить запросы.

**Почему этот приоритет**: Валидация критически важна для безопасности и качества данных, но может быть реализована на базе базового endpoint.

**Независимая проверка**: Можно протестировать отправкой запросов с различными невалидными данными и проверкой возвращаемых ошибок.

**Приемочные сценарии**:

1. **Дано** API endpoint доступен, **Когда** отправляется запрос без обязательного поля email или first_name или last_name, **Тогда** система возвращает статус 422 с указанием отсутствующего поля
2. **Дано** API endpoint доступен, **Когда** отправляется запрос с невалидным форматом email, **Тогда** система возвращает статус 422 с указанием невалидного поля
3. **Дано** API endpoint доступен, **Когда** отправляется запрос с паролем короче 8 символов, **Тогда** система возвращает статус 422 с указанием минимальной длины пароля
4. **Дано** API endpoint доступен, **Когда** отправляется запрос с first_name или last_name, содержащими недопустимые символы (не только русские/английские буквы и тире), **Тогда** система возвращает статус 422 с указанием допустимого формата
5. **Дано** API endpoint доступен, **Когда** отправляется запрос с паролем, не соответствующим требованиям сложности (нет заглавных, строчных или цифр), **Тогда** система возвращает статус 422 с указанием требований сложности

---

### Граничные случаи

- Что происходит при попытке создать пользователя с уже существующим email?
- Что происходит при передаче слишком длинных значений полей (более 255 символов)?
- Что происходит при передаче дополнительных полей, не предусмотренных схемой?
- Как система обрабатывает специальные символы в first_name, last_name и email?
- Что происходит при одновременных запросах на создание пользователей с одинаковым email?

## Требования *(обязательно)*

### Функциональные требования

- **FR-001**: Система ДОЛЖНА предоставлять API endpoint для создания пользователей
- **FR-002**: Система ДОЛЖНА принимать POST-запросы с JSON-телом, содержащим email, first_name, last_name, password
- **FR-003**: Система ДОЛЖНА валидировать все обязательные поля перед сохранением в БД
- **FR-004**: Система ДОЛЖНА возвращать статус 201 и объект пользователя с полями id, email, first_name, last_name при успешном создании
- **FR-005**: Система ДОЛЖНА возвращать статус 409 при попытке создать пользователя с уже существующим email
- **FR-006**: Система ДОЛЖНА возвращать статус 422 при невалидных данных с детализацией ошибок валидации
- **FR-007**: Система ДОЛЖНА хешировать пароли перед сохранением в БД
- **FR-008**: Система ДОЛЖНА гарантировать уникальность email в системе
- **FR-009**: Система ДОЛЖНА валидировать формат email перед сохранением
- **FR-010**: Система ДОЛЖНА валидировать формат first_name и last_name (только русские и английские буквы и тире)
- **FR-011**: Система ДОЛЖНА валидировать минимальную длину password (8 символов) и сложность: минимум 1 заглавная буква, 1 строчная буква и 1 цифра
- **FR-012**: Система НЕ ДОЛЖНА возвращать пароль в ответе API (даже захешированный)

### Ключевые сущности

- **Пользователь (User)**: Сущность, представляющая пользователя системы с атрибутами id, email, first_name, last_name, password_hash (захешированный пароль), created_at, updated_at

## Предположения

- Используется стандартный алгоритм хеширования паролей (bcrypt или аналогичный)
- Валидация email следует стандарту RFC 5322 (упрощённая проверка формата)
- first_name и last_name могут содержать только русские и английские буквы и тире
- Пароль ДОЛЖЕН соответствовать требованиям сложности: минимум 1 заглавная буква, 1 строчная буква, 1 цифра
- API не требует аутентикации для создания пользователей (public endpoint)
- Лимиты на длину полей: email (до 255 символов), first_name (до 100 символов), last_name (до 100 символов), password (8-100 символов)

## Критерии успеха *(обязательно)*

### Измеримые результаты

- **SC-001**: API корректно обрабатывает 100 запросов в секунду на создание пользователей без деградации производительности
- **SC-002**: 100% созданных пользователей имеют захешированные пароли в БД (plain text пароли не хранятся)
- **SC-003**: 95% валидных запросов на создание пользователей завершаются успешно (статус 201)
- **SC-004**: Все попытки создать дубликат email корректно отклоняются со статусом 409
- **SC-005**: API предоставляет понятные сообщения об ошибках для всех случаев невалидных данных

## Исключения из области действия

- **НЕ входит в scope**: Аутентикация и авторизация пользователей
- **НЕ входит в scope**: Обновление или удаление пользователей
- **НЕ входит в scope**: Подтверждение email через верификационную ссылку
- **НЕ входит в scope**: Управление ролями и правами доступа
- **НЕ входит в scope**: UI для создания пользователей (только API)
- **НЕ входит в scope**: Логирование действий пользователя (аудит)
- **НЕ входит в scope**: Восстановление пароля